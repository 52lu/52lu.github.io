---
title: 进程、线程、协程
date: 2018-07-13 13:48:27
tags:
 - 并发
categories:
 - 并发
---

# 1. 进程和线程介绍
## 1.1 进程和线程的介绍

### 1.1.1 进程
进程是程序在操作系统中的一次执行过程，是系统进行资源分配和调度的基本单位，每个进程都有自己的独立内存空间，不同进程通过进程间通信来通信。由于进程比较重量，占据独立的内存，所以上下文进程间的切换开销（栈、寄存器、虚拟内存、文件句柄等）比较大，但相对比较稳定安全

### 1.1.2 线程
线程是进程的一个实体,是CPU调度和分派的基本单位,它是比进程更小的能独立运行的基本单位.线程自己基本上不拥有系统资源,只拥有一点在运行中必不可少的资源(如程序计数器,一组寄存器和栈),但是它可与同属一个进程的其他的线程共享进程所拥有的全部资源。线程间通信主要通过共享内存，上下文切换很快，资源开销较少，但相比进程不够稳定容易丢失数据。


### 1.1.3 协程
协程是一种用户态的轻量级线程，协程的调度完全由用户控制。协程拥有自己的寄存器上下文和栈。协程调度切换时，将寄存器上下文和栈保存到其他地方，在切回来的时候，恢复先前保存的寄存器上下文和栈，直接操作栈则基本没有内核切换的开销，可以不加锁的访问全局变量，所以上下文的切换非常快。

### 1.1.4 进程和线程的关系
- 一个进程可以创建和销毁多个线程，同一个进程中的多个线程可以并发执行
- 一个程序至少有一个进程，一个进程至少有一个线程



## 1.2 区别

### 1.2.1 进程与线程比较
- <b>地址空间</b>: 线程是进程内的一个执行单元，进程内至少有一个线程，它们共享进程的地址空间，而进程有自己独立的地址空间
- <b>资源拥有</b>: 进程是资源分配和拥有的单位,同一个进程内的线程共享进程的资源
- <b>基本单位</b>: 线程是CPU调度的基本单位,进程是系统进行资源分配和调度的基本单位
- <b>并发执行</b>: 二者均可并发执行
-  <b>层级关系</b>: 一个进程可以创建和销毁多个线程，同一个进程中的多个线程可以并发执行
- <b>执行过程</b>: 线程在执行过程中与进程还是有区别的。每个独立的线程有一个程序运行的入口、顺序执行序列和程序的出口。`但是线程不能够独立执行，必须依存在应用程序中，由应用程序提供多个线程执行控制。`

** 为了加深理解，做个简单的比喻：进程=火车，线程=车厢 **
1. 线程在进程下行进（单纯的车厢无法运行）
2. 一个进程可以包含多个线程（一辆火车可以有多个车厢）
3. 不同进程间数据很难共享（一辆火车上的乘客很难换到另外一辆火车，比如站点换乘）
4. 同一进程下不同线程间数据容易共享（A车厢换到B车厢很容易）
5. 进程要比线程消耗更多的计算机资源（采用多列火车相比多个车厢更耗资源）
6. 进程间不会相互影响，一个线程挂掉将导致整个进程挂掉（一列火车不会影响到另外一列火车，但是如果一列火车上中间的一节车厢与前一节产生断裂，将影响后面的所有车厢）
7. 进程可以拓展到多机，进程最适合多核（不同火车可以开在多个轨道上，同一火车的车厢不能在行进的不同的轨道上）
8. 进程使用的内存地址可以上锁，即一个线程使用某些共享内存时，其他线程必须等它结束，才能使用这一块内存。（比如火车上的洗手间）－"互斥锁"
9. 进程使用的内存地址可以限定使用量（比如火车上的餐厅，最多只允许多少人进入，如果满了需要在门口等，等有人出来了才能进去）－"信号量"


### 1.2.2 协程与线程进行比较
- 一个线程可以多个协程，一个进程也可以单独拥有多个协程，这样python中则能使用多核CPU。
- 线程进程都是同步机制，而协程则是异步
- 协程能保留上一次调用时的状态，每次过程重入时，就相当于进入上一次调用的状态

### 1.2.3 其他介绍资料
- [进程与线程的一个简单解释(阮一峰)](http://www.ruanyifeng.com/blog/2013/04/processes_and_threads.html)
- [漫画：什么是协程？](https://www.itcodemonkey.com/article/4620.html)
